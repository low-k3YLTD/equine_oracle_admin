/**
 * CSV Export Utility
 * Generates CSV files from prediction data
 */

import { Prediction } from \"../../drizzle/schema\";\n\n/**\n * Convert predictions to CSV format\n */\nexport function predictionsToCSV(predictions: Prediction[]): string {\n  if (predictions.length === 0) {\n    return \"No predictions to export\";\n  }\n\n  // CSV headers\n  const headers = [\n    \"ID\",\n    \"Horse Name\",\n    \"Track\",\n    \"Race Type\",\n    \"Distance\",\n    \"Race Date\",\n    \"LightGBM\",\n    \"XGBoost\",\n    \"Random Forest\",\n    \"Gradient Boosting\",\n    \"Logistic Regression\",\n    \"Ensemble\",\n    \"Confidence\",\n    \"Created At\",\n  ];\n\n  // CSV rows\n  const rows = predictions.map((p) => [\n    p.id.toString(),\n    escapeCSVField(p.horseName),\n    escapeCSVField(p.track),\n    escapeCSVField(p.raceType),\n    p.distance.toString(),\n    escapeCSVField(p.raceDate),\n    formatProbability(p.lightgbmProbability),\n    formatProbability(p.xgboostProbability),\n    formatProbability(p.randomForestProbability),\n    formatProbability(p.gradientBoostingProbability),\n    formatProbability(p.logisticRegressionProbability),\n    formatProbability(p.ensembleProbability),\n    escapeCSVField(p.confidence || \"\"),\n    p.createdAt.toISOString(),\n  ]);\n\n  // Combine headers and rows\n  const csvContent = [\n    headers.join(\",\"),\n    ...rows.map((row) => row.join(\",\")),\n  ].join(\"\\n\");\n\n  return csvContent;\n}\n\n/**\n * Escape CSV fields that contain commas, quotes, or newlines\n */\nfunction escapeCSVField(field: string): string {\n  if (field.includes(\",\") || field.includes('\"') || field.includes(\"\\n\")) {\n    return `\"${field.replace(/\"/g, '\"\"')}\"`;\n  }\n  return field;\n}\n\n/**\n * Format probability from 0-10000 scale to 0-100 percentage\n */\nfunction formatProbability(probability: number | null | undefined): string {\n  if (!probability) return \"0.00%\";\n  const percentage = (probability / 10000) * 100;\n  return `${percentage.toFixed(2)}%`;\n}\n\n/**\n * Generate CSV filename with timestamp\n */\nexport function generateCSVFilename(): string {\n  const now = new Date();\n  const timestamp = now.toISOString().replace(/[:.]/g, \"-\").split(\"T\")[0];\n  return `predictions-${timestamp}.csv`;\n}\n
